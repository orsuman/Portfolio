<div class = "container yield">

    <div class="col-xs-6 col-xs-offset-2">
      <h2><span class = "subject">相談事例</span></h2></br>
    </div>

    <div class="col-xs-7 col-xs-offset-2">
        <label class="col-xs-3">相談者の名前</label>
          <span class ="col-xs-9">
            <% if @trouble.user.deleted_at == nil %>
              <% if admin_signed_in? %>
                <%= link_to user_path(@trouble.user) do %><%= @trouble.user.nickname %><% end %> 様
              <% elsif lawyer_signed_in? %>
                <% if @users.include?(@trouble.user.id) %>
                  <%= link_to user_path(@trouble.user) do %><%= @trouble.user.nickname %><% end %> 様
                <% else %>
                  <%= @trouble.user.nickname %> 様
                <% end %>
              <% else %>
                <%= @trouble.user.nickname %> 様
              <% end %>
            <% else %>
              退会したユーザー
            <% end %>
          </span>
    </div>
    <div class="col-xs-7 col-xs-offset-2">
        <label class="col-xs-3">カテゴリー</label>
          <span class ="col-xs-9"><%= @trouble.category.name %></span>
    </div>
    <div class="col-xs-7 col-xs-offset-2">
        <label class="col-xs-3">投稿日時</label>
          <span class ="col-xs-9"><%= @trouble.created_at.strftime('%Y年%m月%d日 %H時%M分') %></span>
    </div>
    <div class="col-xs-7 col-xs-offset-2">
        <% unless @trouble.image_id.nil? %>
        <label class="col-xs-12">説明写真</label>
          <span class ="col-xs-12"><%= attachment_image_tag @trouble, :image, :fill, 600, 300, size:'600x300' %></span>
        <% end %>
    </div>
    <div class="col-xs-7 col-xs-offset-2"><br/>
        <label class="col-xs-12">タイトル</label>
          <span class ="col-xs-7"><%= @trouble.title %></span>
    </div>
    <div class="col-xs-7 col-xs-offset-2"><br/>
        <label class="col-xs-12">投稿内容</label>
          <span class ="col-xs-12"><%= safe_join(@trouble.body.split("\n"),tag(:br)) %></span>
    </div>

    <% if admin_signed_in? %>
      <div class="col-xs-3 col-xs-offset-7"><br/>
        <%= link_to "強制削除する", admin_trouble_path(@trouble), method: :delete, "data-confirm"  => "[要確認!!]コメントがあれば一緒に削除されてしまいます!!本当に削除しますか？", class: "btn btn-danger" %>
      </div>
    <% end %>

    <% if lawyer_signed_in? %>
      <% if @trouble.user.deleted_at == nil %>
        <% unless Comment.exists?(trouble_id: @trouble.id, lawyer_id: current_lawyer.id) %>
          <div class="col-xs-7 col-xs-offset-2 actions">
            <%= link_to "この相談に回答する", new_comments_path(trouble_id: @trouble.id), class:"btn btn-primary col-xs-12" %><br/>
          </div>
        <% else %>
          <div class="col-xs-7 col-xs-offset-2 actions">
            <h5 class="required", style="text-align:center;">※既に回答して頂いているので、再度の回答はできません。</h5>
          </div>
        <% end %>
      <% end %>
    <% end %>

    <% if @trouble.comments.count > 0 %>
      <div class="col-xs-6 comments"></div>
    <% end %>

    <% @trouble.comments.each do |comment| %>
      <div class="col-xs-6 col-xs-offset-2 comment">
        <label class="col-xs-3">回答者</label>
          <span class ="col-xs-9">
            <% if comment.lawyer.deleted_at == nil %>
              <% if admin_signed_in?  %>
                <%=link_to lawyer_path(comment.lawyer_id) do %><%= comment.lawyer.name %><% end %> 様より
              <% elsif lawyer_signed_in? %>
                <% if current_lawyer.id == comment.lawyer.id %>
                  <%=link_to lawyer_path(comment.lawyer_id) do %><%= comment.lawyer.name %><% end %> 様より
                <% else %>
                  <%= comment.lawyer.prefecture %>の<%= comment.lawyer.profession %>の先生より
                <% end %>
              <% elsif user_signed_in? %>
                  <%=link_to lawyer_path(comment.lawyer_id) do %><%= comment.lawyer.name %><% end %> 様より
              <% end %>
            <% else %>
              退会したユーザー
            <% end %>
          </span>
      </div></br></br>
      <div class="col-xs-6 col-xs-offset-2">
        <label class="col-xs-3">回答日時</label>
          <span class ="col-xs-9"><%= comment.created_at.strftime('%Y年%m月%d日 %H時%M分') %></span>
    　</div>
      <div class="col-xs-7 col-xs-offset-2">
        <label class="col-xs-12">回答内容</label>
          <span class ="col-xs-12"><%= safe_join(comment.comment.split("\n"),tag(:br)) %></span>
      </div>
      <% if admin_signed_in? %>
        <div class="col-xs-4 col-xs-offset-6"><br/>
          <%= link_to "強制削除する", admin_comment_path(comment), method: :delete, "data-confirm"  => "[要確認!!]本当に削除しますか？", class: "btn btn-danger" %>&nbsp;&nbsp;
          <span class="glyphicon glyphicon-thumbs-up" style="color:#000000;">参考になった<%= comment.references.count %></span>
        </div>
      <% elsif user_signed_in? %>
        <div class="col-xs-4 col-xs-offset-7"><br/>
          <%= render 'users/references/reference', comment: comment %>
        </div>
      <% else %>
        <div class="col-xs-4 col-xs-offset-7"><br/>
          <span class="glyphicon glyphicon-thumbs-up" style="color:#000000;">参考になった<%= comment.references.count %></span>
        </div>
      <% end %>
    <% end %>

</div>